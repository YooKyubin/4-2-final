## 4.3.2 히스토그램 평활화
히스토그램 스트레칭의 단점
- 유저의 입력이 요구됨

히스토그램 평활화
- 히스토그램을 균일하게 변경
- 히스토그램의 모든 바를 동일한 높이로 만드는 것
- 영상의 모든 그레이 값의 빈도수를 같게 만든다. (사실 오리지널 신호라서 불가능하지만 유사하게 노력함)
- 자동적으로 수행


$L$: 그레이 레벨의 갯수
$n_i$: i번째 그레이 레벨의 이미지에서 빈도수
$$
\left( \frac{n_0 + n_1+ \cdots +n_i}{n}\right) (L-1)
$$
가장 근접한 정수로 반올림한다.

| Gray level i | 0   | 1   | 2   | 3   | 4   | 5   | 6   | 7   | 8   | 9   | 10  | 11  | 12  | 13  | 14  | 15  |
| ------------ | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| $n_i$        | 15  | 0   | 0   | 0   | 0   | 0   | 0   | 0   | 0   | 70  | 110 | 45  | 80  | 40  | 0   | 0   |

![[Pasted image 20230611012248.png]]

| Gray level$i$ | $n_i$ | $\Sigma n_i$ | $(L-1)/n \; \Sigma{n_i}$ | Rounded value |
| ------------- | ----- | ------------ | ------------------------ | ------------- |
| 0             | 15    | 15           | 0.63                     | 1             |
| 1             | 0     | 15           | 0.63                     | 1             |
| 2             | 0     | 15           | 0.63                     | 1             |
| 3             | 0     | 15           | 0.63                     | 1             |
| 4             | 0     | 15           | 0.63                     | 1             |
| 5             | 0     | 15           | 0.63                     | 1             |
| 6             | 0     | 15           | 0.63                     | 1             |
| 7             | 0     | 15           | 0.63                     | 1             |
| 8             | 0     | 15           | 0.63                     | 1             |
| 9             | 70    | 85           | 3.65                     | 4             |
| 10            | 110   | 195          | 8.13                     | 8             |
| 11            | 45    | 240          | 10                       | 10            |
| 12            | 80    | 320          | 13.33                    | 13            |
| 13            | 40    | 360          | 15                       | 15            |
| 14            | 0     | 360          | 15                       | 15            |
| 15            | 0     | 360          | 15                       | 15              |

변경된 히스토그램
![[Pasted image 20230611013029.png]]

```mat
histeq(img)
```

### 왜 작동하는가? 작동 원리

누적 히스토그램의 모습을 스트레칭 함수라고 간주한다.
![[Pasted image 20230611014447.png]]
y값을 0~360이 아닌 0~15 사이의 값으로 스케일링하면 스트레칭과 유사하다.

>평활화를 진행 후 히스토그램의 값이 동일하지 않은 것은 이미지가 이산 데이터이기 때문이다.
>아날로그 연속함수로 평활화했으면 동일하게 나왔을것임


# 4.4 룩업 테이블(LUT)
화소단위 처리 연산을 효율적으로 하기위함
256크기의 배열이며 임의의 연산은 각 화소값 $p$를 테이블 내의 대응 값 $t_p$로 치환하며 구현될 수 있다.

예시
```mat
T = uint8(floor([0:255]/2));
b2 = T(b+1)     % 인덱스 때문에 b+1, matlab은 1부터 인덱스 시작
```


blocks.tif 에 적용
![[Pasted image 20230611015732.png]]

![[Pasted image 20230611015721.png]]
```mat
t1 = 0.667 * [0:96];
t2 = 2 * [97:160] - 128;
t3 = 0.6632 * [161:255] + 85.89;
T = uint8(floor([t1 t2 t3]));
```