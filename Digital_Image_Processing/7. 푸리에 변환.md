# 7.1 서론
어떤 다른 방법으로 처리하기 불가능한 것을 가능하게 해준다.
효율 (빠름)
선형 공간 필터링에 탁월한 능력
큰 크기의 공간 필터를 사용하는 것보다 푸리에 변환이 효율적이다.
푸리에 변환을 통해 특정 이미지 주파수를 분리 및 처리할 수 있다.

# 7.2 배경
영상에서의 주파수
![[Pasted image 20230612164419.png]]

### Image transform
주파수 변환
- 공간 영역 형태의 영상을 주파수 영역 형태의 기본 주파수로 분리하는 것
- 정규적인 변환이 성립하려면 역변환도 성립되어야 함
	- 주파수 변환에는 주파수 형태의 영상을 공간 형식으로 변환하는 역 주파수 변환이 반드시 있어야 함
		![[Pasted image 20230612164651.png]]


### Signal
신호를 구성하는 세 가지 요소
- 주기 $T$ : 반복되는 시간
- 진폭 $A$ : 파형의 크기, 0에서 양의 최대 높이까지의 거리
- 위상 $\Phi$: 파형의 시작이 얼만큼 지연되고 선행되었는지를 나타내는 시간 차이
![[Pasted image 20230612164905.png]]

### Fourier Transform
1D 신호의 푸리에 변환 결과
![[Pasted image 20230612164951.png]]
> (a) 가장 빨리 변하는 부분이 주파수가 높은 부분
> (b) 에서 양수 부분만 신경쓰고 사용하게 된다. 음수 부분은 그냥 대칭임, 0일때 평균 값
> (c) 영상 처리에서는 잘 사용되지 않음, 영상이 시프트 된 경우에 사용

- 주파수 영역으로 변환하는 가장 일반적인 방법
- 임의의 입력 신호를 다양한 주파수로 갖는 주기함수 (sin, cos)들의 합으로 분해하여 표현
- 입력: 1D 음성 또는 2D 영상 등
- 푸리에 결과: sin 과 cos 성분으로 분해
![[Pasted image 20230612165126.png]]
입력함수 f(x)를 여러개의 주기함수로 분해한 모습

![[Pasted image 20230612165757.png]]
입력 주기 함수를 여러개의 주파수 계수로 분해한다.
오른쪽의 파란색 빠큐높이가 A(f) 인듯?

**변환 수식**
푸리에 변환 쌍
- 푸리에 역변환
$$
f(x) = \int_{-\infty}^{\infty} F(u)e^{j\ 2\ \pi\ u\ x}du
$$
- 푸리에 변환
$$
F(u) = \int_{-\infty}^{\infty} f(x)e^{-j\ 2\ \pi\ u\ x}dx
$$
- f(x): 1D 입력 신호
- F(u): 해당 주기 함수 성분의 계수 (주파수 계수)
- $e^{j2 \pi ux} = \cos{2\pi ux}\ +\ j\sin{2\pi ux}$: 주파수 u(주기 1/u)인 주기 함수 성분
> 의미
> 식(푸리에 역변환): 입력 신호 f(x) 가  $e^{j2 \pi ux}$들의 합으로 표현(분해)
> 식(푸리에 변환): f(x)를 주기 함수 성분으로 분해했을 때의 계수 F(u)를 구함
>  F(u=0) 이라면 f(x)의 넓이를 구하는 식이 됨( 이미지의 평균값, 면적)


주기 함수는 다양한 주기와 진폭을 가지는 sin, cos 함수의 합으로 쓸 수 있다.
![[Pasted image 20230612170242.png]]
- 아래의 식이 무한히 이어진다면 위의 구형파(이산적인 모습)가 된다.

# 7.3 1D DFT(Discrete Fourier Transform)

이산 수열\[1 1 1 1 -1 -1 -1 -1] 에 대하여여
![[Pasted image 20230612170403.png]]

FFT(Fast Fourier Transform): DFT 의 빠르고 효율적인 버전
- 2의 거듭제곱의 샘플 수만 가능하다. 600개라면 1024개로 0을 채워 사용해야 한다.
- 고속 푸리에 변환

# 7.5 2차원 DFT
2차원 푸리에 변환은 파형(corrugations)의 합으로 원본 행렬을 다시 작성한다.

2D DFT and It's Inverse
![[Pasted image 20230612220924.png]]
>일반적인 푸리에 변환식과는 달리 W와 H로의 나누기가 들어있음에 유의해야 하며 이는 데이터가 정의된 구간을 하나의 단위 주기(unit period)로 만드는 효과가 있다. 일종의 정규화 팩터(normalization factor)라고 생각하면 된다.

특징
- 주파수 공간의 원점 F(0,0)의 값은 이미지의 평균 값과 일치
- lmpulse 함수에 대한 푸리에 변환/역변환은 유니폼 함수
- 가우시언 함수의 푸리에 변환/역변환은 가우시안 함수가 된다.

## 7.5.1 2차원 DFT의 성질
**THE CONVOLUTIOIN THEOREM** (합성곱 연산이 1:1 곱셈 연산과 같아짐)
이미지 M을 공간 필터 S로 convolution 할때
- S에 M과 크기가 같아질때 까지 0패딩을 한다. 이를 S' 이라한다.
- M과 S'에 대하여 DFT를 수행한다. F(M), F(S')을 얻는다.
- 두 개의 변한을 요소 곱을 한다.
	![[스크린샷 2023-06-12 오후 11.00.24.png|200]]
- 그 결과를 다시 역변환한다.
	![[스크린샷 2023-06-12 오후 11.00.51.png|200]]
	> 영상의 크기(가로, 세로)가 2의 제곱수가 아닌경우라면 FFT를 하기위해 0을 채우면 된다.
	
간단한 식으로 다시 본다면
$$
M*S = \mathcal{F}^{-1}(\mathcal{F}(M)\ \cdot \ \mathcal{F}(S'))
$$
혹은
$$
\mathcal{F}(M*S) = \mathcal{F}(M) \cdot \mathcal{F}(S')
$$

직류 계수: 식에 따라 ㅏ자꾸 달라지는데 일단 원래의 매트릭스 내의 모든 항들의 합
이동성
공액복소수 대칭성

# 7.6 MATLAB에서 푸리에 변환
- `fft`: 벡터의 DFT 변환
- `ifft`: 벡터의 역 DFT 변환
- `fft2`: 행렬의 DFT 변환
- `ifft2`: 행렬의 역 DFT 변환
- `fftshift`: 변환 이동

예시
```
af = fftshift(fft2(a));
round(abs(af))
```

# 7.7 영상의 푸리에 변환
푸리에 변환된 스펙트럼을 보기 위해 2가지 방법
```
af1 = log(1 + abs(af));
imshow(af1/af1(129,129))
```
- 직류 계수의 위치가 129, 129에 위치하기 때문에 잘 작동한다.
- log로 스트레칭하고 최대값으로 나누어 0.0 ~ 1.0 사이로 값을 위치시킴

```
imshow(mat2gray(log(1 + abs(af))))
```
- 이전에도 설명했지만 `mat2gray`는 자동으로 스케일링한다.

![[스크린샷 2023-06-12 오후 11.43.48.png]]

![[스크린샷 2023-06-12 오후 11.44.03.png]]


예제 7.7.2
박스 영상을 만들고 이의 푸리에 변환을 살펴보자
```
a = zeros(256,256);
a(78:178, 78:178) = 1;
af = fftshift(fft2(a));
fftshow(af,'abs')
```
![[스크린샷 2023-06-12 오후 11.48.37.png]]

45도 회전 박스 영상의 DFT
![[스크린샷 2023-06-12 오후 11.49.17.png]]
회전된 박스의 변환은 원래 박스의 변환을 회전한 것과 같다.

원
```
[x , y] = meshgrid(-128:217, -128:217);
z = sqrt(x.^2 + y.^2);
```
![[스크린샷 2023-06-12 오후 11.51.32.png]]
cutoff 특성을 가진 원에 의해 진동(ringing) 현상이 일어남
에지가 변환 영역에서 에지에 직각 방향으로 하나의 라인으로 나타난다.
라인 위에 그 값을 에지를 구성하고 있는 주름 함수들의 계수들로 간주할 수 있다.


블러된 원은 DFT 변환해도 똑같다는데 실험 해보고 싶긴함
![[스크린샷 2023-06-12 오후 11.52.31.png]]
흐릿한 원은 이의 변환도 유사함, 예리한 원처럼 진동현상이 발생하지 않음


# 7.8 주파수 영역에서의 필터링
Filtering in the Frequency Domain

### 7.8.1 이상적인 필터링
로우 패스 필터링
저주파 성분이 중심 부근에 있기 때문에 중심 부근의 값들은 그대로 유지하고 중심에서 먼 곳에 있는 값들은 제거하거나 최소화를 하는 방법으로 매트릭스와 변환 계수를 곱하면 로우패스 필터링을 수행할 수 있다.
이 방법중 한가지가 이상적인 저역통과 매트릭스를 곱하는 것이다.
![[스크린샷 2023-06-13 오전 12.32.54.png]]
$$
\mathcal{F}^{-1}(F \cdot m)
$$
F와 m의 요소 간 곱을 수행한 후 그 결과를 역변환 한다.
![[스크린샷 2023-06-13 오전 12.36.59.png]]

원이 커질수록 영상이 또렷해짐

**하이패스 필터링**
저주파통과 필터링의 반대로 중심부근의 값들을 제거하고 그 외의 값들을 유지한다.
![[스크린샷 2023-06-13 오전 12.44.15.png]]



### 7.8.2 Butterworth Filtering
이상적인 필터링은 단순하게 중심으로부터 어떤 거리에서 푸리에 변환을 차단하는 것이다.
원하지 않은 가공현상(ringing)현상이 발생할 수 있는 단점이 있다.

이러한 현상을 피하는 방법은 차단 특성이 예리하지 않은 원을 필터 매트릭스로 사용하는 것이다.
중 널리 사용되는 것은 버터워스 필터이다.

Ideal filter
![[스크린샷 2023-06-13 오전 12.50.34.png]]

Butterworth filter
저주파 통과 필터
$$
f(x) = \frac{1}{1+(x/D)^{2n}}
$$
고주파 통과 필터
$$
f(x) = \frac{1}{1+(D/x)^{2n}}
$$
![[스크린샷 2023-06-13 오전 1.03.32.png]]

(b) = 1 - (a)로 만들 수 있다.

적용 예시
```
bl = lbutter(cm, 15, 1);
cfbl = cf .* bl;
figure, fftshow(cfbl, 'log')
```

### 7.8.3 Gaussian Filtering
주파수 영역에서 가우시안 필터링

가우시안 필터를 만들고, 이를 변환된 영상과 곱한 다음, 그 결과를 역변환 한다.
가우시안의 푸리에 변환은 항상 가우시안 이기 때문에 선형 가우시안 공간 필터를 사용할때와 같은 결과를 정확히 얻을 수 있다.

```
g = mat2gray(fspecial('gausiian', 256, 10));
cg = cf .* gl;
fftshow(cg, 'log')
```
가우시안 필터의 중심값을 항상 1로 유지시키기위해 mat2gray 함수를 사용한다.
- 가우시안은 표준편차가 커지면 중앙의 최대값이 작아짐


![[스크린샷 2023-06-13 오전 1.13.16.png]]

고주파는 `1-g`로 간단하게 구할 수 있다.
![[스크린샷 2023-06-13 오전 1.13.58.png]]







